# Script PowerShell de cr√©ation des issues pour le Module Produits/Services
# N√©cessite GitHub CLI (gh) install√© et configur√©

Write-Host "üì¶ Cr√©ation des issues pour le Module Produits/Services" -ForegroundColor Green
Write-Host "====================================================`n" -ForegroundColor Green

# V√©rifier que gh CLI est install√©
if (-not (Get-Command gh -ErrorAction SilentlyContinue)) {
    Write-Host "‚ùå GitHub CLI (gh) n'est pas install√©. Veuillez l'installer d'abord." -ForegroundColor Red
    exit 1
}

# V√©rifier l'authentification
$authStatus = gh auth status 2>&1
if ($LASTEXITCODE -ne 0) {
    Write-Host "‚ùå Vous n'√™tes pas authentifi√© avec GitHub CLI. Ex√©cutez 'gh auth login' d'abord." -ForegroundColor Red
    exit 1
}

Write-Host "üìù Cr√©ation des issues pour le d√©veloppement du module..." -ForegroundColor Cyan

# D√©finition des issues pour le Module Produits/Services
$issues = @(
    @{
        title = "[PRODUITS] Cr√©ation du mod√®le de base Produit"
        body = @"
## Description d√©taill√©e

Cr√©er le mod√®le de base pour la gestion des produits dans le contexte BTP, incluant les mat√©riaux, fournitures, et services.

### Contexte m√©tier
- Besoin de g√©rer un catalogue de produits/services pour les devis et factures
- Distinction entre mat√©riaux (quantifiables) et services (temps/forfait)
- Gestion des prix d'achat et de vente
- Suivi des stocks pour les mat√©riaux

### Solution propos√©e
Mod√®le Produit avec les caract√©ristiques sp√©cifiques au BTP

## Crit√®res d'acceptation

- [ ] Mod√®le Produit cr√©√© avec les champs essentiels
- [ ] Migration de base de donn√©es
- [ ] Relations avec les autres entit√©s (fournisseurs, cat√©gories)
- [ ] Validation des donn√©es
- [ ] Tests unitaires
- [ ] Documentation du mod√®le

## Sp√©cifications techniques

- **Mod√®le** : `App\Models\Commerce\Produit`
- **Migration** : `create_produits_table`
- **Champs principaux** :
  - R√©f√©rence, nom, description
  - Type (mat√©riau/service)
  - Unit√© de mesure
  - Prix d'achat/vente
  - TVA applicable
  - Stock minimum/actuel
  - Fournisseur principal
  - Cat√©gorie

## Estimation d'effort
üïì 2-3 jours
"@
        labels = @("module:produits-services", "priorite:haute", "type:feature")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] Interface de gestion du catalogue produits"
        body = @"
## Description d√©taill√©e

D√©velopper l'interface utilisateur pour la gestion compl√®te du catalogue de produits et services.

### Contexte m√©tier
- Les utilisateurs doivent pouvoir cr√©er, modifier et consulter les produits
- Interface intuitive pour la saisie rapide
- Recherche et filtrage efficaces
- Import/export pour la gestion en masse

### Solution propos√©e
Interface Livewire compl√®te avec CRUD et fonctionnalit√©s avanc√©es

## Crit√®res d'acceptation

- [ ] Page de liste des produits avec recherche/filtres
- [ ] Formulaire de cr√©ation/√©dition
- [ ] Gestion des cat√©gories
- [ ] Import CSV/Excel
- [ ] Export des donn√©es
- [ ] Interface responsive
- [ ] Tests fonctionnels

## Sp√©cifications techniques

- **Composants Livewire** :
  - `ProduitsList`
  - `ProduitsForm`
  - `ProduitsImport`
- **Vues** : Blade templates avec TailwindCSS
- **Validation** : Form requests
- **Export** : Laravel Excel

## Estimation d'effort
üïî 1 semaine
"@
        labels = @("module:produits-services", "priorite:haute", "type:feature", "transversal:ux")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] Gestion des cat√©gories et sous-cat√©gories"
        body = @"
## Description d√©taill√©e

Syst√®me de cat√©gorisation hi√©rarchique pour organiser les produits et services selon les m√©tiers du BTP.

### Contexte m√©tier
- Organisation par corps de m√©tier (ma√ßonnerie, √©lectricit√©, plomberie, etc.)
- Sous-cat√©gories pour affiner la classification
- Faciliter la recherche et la navigation
- Statistiques par cat√©gorie

### Solution propos√©e
Mod√®le de cat√©gories avec structure hi√©rarchique

## Crit√®res d'acceptation

- [ ] Mod√®le Categorie avec parent/enfants
- [ ] Interface de gestion des cat√©gories
- [ ] Arbre hi√©rarchique dans l'interface
- [ ] Association produits/cat√©gories
- [ ] Migration des donn√©es existantes
- [ ] Tests unitaires et fonctionnels

## Sp√©cifications techniques

- **Mod√®le** : `App\Models\Commerce\Categorie`
- **Relations** : Self-referencing (parent_id)
- **Package** : Nested Set ou Adjacency List
- **Interface** : Tree view avec drag & drop

## Estimation d'effort
üïì 2-3 jours
"@
        labels = @("module:produits-services", "priorite:haute", "type:feature")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] Gestion des prix et tarifs"
        body = @"
## Description d√©taill√©e

Syst√®me de gestion des prix complexe adapt√© aux sp√©cificit√©s du BTP (prix d√©gressifs, tarifs clients, etc.).

### Contexte m√©tier
- Prix d'achat et de vente variables
- Tarifs sp√©ciaux par client/fournisseur
- Prix d√©gressifs selon quantit√©s
- Gestion des remises
- Historique des prix

### Solution propos√©e
Mod√®le de tarification flexible avec historique

## Crit√®res d'acceptation

- [ ] Mod√®le Prix avec versioning
- [ ] Tarifs par client/fournisseur
- [ ] Grilles de prix d√©gressifs
- [ ] Gestion des remises
- [ ] Interface de saisie des prix
- [ ] Historique et tra√ßabilit√©
- [ ] Tests de calculs

## Sp√©cifications techniques

- **Mod√®les** :
  - `ProduitPrix`
  - `TarifClient`
  - `GrillePrix`
- **Calculs** : Service de pricing
- **Validation** : R√®gles m√©tier complexes

## Estimation d'effort
üïî 1 semaine
"@
        labels = @("module:produits-services", "priorite:haute", "type:feature")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] Gestion des stocks et approvisionnement"
        body = @"
## Description d√©taill√©e

Module de gestion des stocks pour les mat√©riaux avec alertes et suivi des mouvements.

### Contexte m√©tier
- Suivi des stocks en temps r√©el
- Alertes de stock minimum
- Mouvements d'entr√©e/sortie
- Inventaires p√©riodiques
- Valorisation des stocks

### Solution propos√©e
Syst√®me de gestion des stocks int√©gr√©

## Crit√®res d'acceptation

- [ ] Mod√®le Stock avec mouvements
- [ ] Alertes de stock minimum
- [ ] Interface de gestion des stocks
- [ ] Mouvements d'entr√©e/sortie
- [ ] Inventaires
- [ ] Rapports de valorisation
- [ ] Tests de coh√©rence

## Sp√©cifications techniques

- **Mod√®les** :
  - `Stock`
  - `MouvementStock`
  - `Inventaire`
- **Jobs** : Alertes automatiques
- **Rapports** : Valorisation FIFO/LIFO

## Estimation d'effort
üïî 1 semaine
"@
        labels = @("module:produits-services", "priorite:moyenne", "type:feature")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] API REST pour int√©gration externe"
        body = @"
## Description d√©taill√©e

API REST pour permettre l'int√©gration avec des syst√®mes externes (fournisseurs, e-commerce, etc.).

### Contexte m√©tier
- Synchronisation avec catalogues fournisseurs
- Int√©gration e-commerce
- √âchange de donn√©es avec partenaires
- Automatisation des approvisionnements

### Solution propos√©e
API REST compl√®te avec authentification

## Crit√®res d'acceptation

- [ ] Endpoints CRUD pour produits
- [ ] Authentification API (Sanctum)
- [ ] Documentation OpenAPI
- [ ] Rate limiting
- [ ] Validation des donn√©es
- [ ] Tests API
- [ ] Versioning

## Sp√©cifications techniques

- **Routes** : `/api/v1/produits`
- **Auth** : Laravel Sanctum
- **Documentation** : Swagger/OpenAPI
- **Tests** : Feature tests API
- **Validation** : API Resources

## Estimation d'effort
üïì 2-3 jours
"@
        labels = @("module:produits-services", "priorite:moyenne", "type:feature", "transversal:infra")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    },
    @{
        title = "[PRODUITS] Tests et documentation compl√®te"
        body = @"
## Description d√©taill√©e

Finalisation du module avec tests complets et documentation utilisateur/d√©veloppeur.

### Contexte m√©tier
- Assurer la qualit√© du module
- Documentation pour les utilisateurs
- Guide d'int√©gration pour les d√©veloppeurs
- Tests de non-r√©gression

### Solution propos√©e
Suite de tests compl√®te et documentation

## Crit√®res d'acceptation

- [ ] Tests unitaires (>90% coverage)
- [ ] Tests fonctionnels complets
- [ ] Tests d'int√©gration
- [ ] Documentation utilisateur
- [ ] Documentation technique
- [ ] Guide d'installation
- [ ] Exemples d'utilisation

## Sp√©cifications techniques

- **Tests** : PHPUnit + Pest
- **Coverage** : PHPUnit coverage
- **Documentation** : LaRecipe
- **Exemples** : Seeders et factories

## Estimation d'effort
üïì 2-3 jours
"@
        labels = @("module:produits-services", "priorite:moyenne", "type:documentation", "type:tests")
        milestone = "üéØ Q3 2025 - Modules Prioritaires"
    }
)

$created = 0
$errors = 0

foreach ($issue in $issues) {
    Write-Host "üìù Cr√©ation de l'issue : $($issue.title)" -ForegroundColor Yellow

    # Construire la commande avec les labels
    $labelArgs = @()
    foreach ($label in $issue.labels) {
        $labelArgs += "--label"
        $labelArgs += $label
    }

    # Ajouter le milestone si sp√©cifi√©
    $milestoneArgs = @()
    if ($issue.milestone) {
        $milestoneArgs += "--milestone"
        $milestoneArgs += $issue.milestone
    }

    # Cr√©er l'issue
    $result = & gh issue create --title $issue.title --body $issue.body @labelArgs @milestoneArgs 2>&1

    if ($LASTEXITCODE -eq 0) {
        Write-Host "‚úÖ Issue '$($issue.title)' cr√©√©e avec succ√®s" -ForegroundColor Green
        $created++
    } else {
        Write-Host "‚ùå Erreur lors de la cr√©ation de l'issue '$($issue.title)'" -ForegroundColor Red
        Write-Host "   $result" -ForegroundColor Red
        $errors++
    }

    Start-Sleep -Milliseconds 500  # √âviter le rate limiting
}

Write-Host "`nüìä R√©sum√© de la cr√©ation des issues :" -ForegroundColor Cyan
Write-Host "‚úÖ Issues cr√©√©es : $created" -ForegroundColor Green
Write-Host "‚ùå Erreurs : $errors" -ForegroundColor Red

if ($created -gt 0) {
    Write-Host "`nüéâ Issues du Module Produits/Services cr√©√©es avec succ√®s !" -ForegroundColor Green
    Write-Host ""
    Write-Host "üìù Prochaines √©tapes recommand√©es :" -ForegroundColor Cyan
    Write-Host "1. Assigner les issues aux d√©veloppeurs" -ForegroundColor White
    Write-Host "2. Prioriser l'ordre de d√©veloppement" -ForegroundColor White
    Write-Host "3. Cr√©er les branches de d√©veloppement" -ForegroundColor White
    Write-Host "4. Commencer par le mod√®le de base" -ForegroundColor White
}
